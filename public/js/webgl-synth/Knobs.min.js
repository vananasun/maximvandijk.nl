var Knob;!function(n){function o(t){return t&&"true"==t.toLowerCase()}function r(t,e,i,a,n){return a+(t-e)/(i-e)*(n-a)}function s(t,e,i){if(i<e){var a=e;e=i,i=a}return t<e?e:i<t?i:t}function l(t,e,i,a){var n=a-e,o=t-i;return function(t){return t*(180/Math.PI)}(Math.atan2(-n,-o)+Math.PI)}function _(t){for(var e=t%360;e<0;)e+=360;return e}var t={__angle:0,__value:0,__centerPageX:0,__centerPageY:0,__isSingleTouch:!(Knob=function(t,e){if(this.__callback=e,this.element=t,!this.element)throw new Error("No input element specified for knob.");var i={};for(var a in t.hasAttribute("min")&&(i.valueMin=parseFloat(t.getAttribute("min"))),t.hasAttribute("max")&&(i.valueMax=parseFloat(t.getAttribute("max"))),t.hasAttribute("value")&&(i.value=parseFloat(t.getAttribute("value"))),t.hasAttribute("data-angle-start")&&(i.angleStart=parseFloat(t.getAttribute("data-angle-start"))),t.hasAttribute("data-angle-end")&&(i.angleEnd=parseFloat(t.getAttribute("data-angle-end"))),t.hasAttribute("data-angle-value-ratio")&&(i.angleValueRatio=parseFloat(t.getAttribute("data-angle-value-ratio"))),t.hasAttribute("data-angle-slide-ratio")&&(i.angleSlideRatio=parseFloat(t.getAttribute("data-angle-slide-ratio"))),t.hasAttribute("data-gesture-spin-enabled")&&(i.gestureSpinEnabled=o(t.getAttribute("data-gesture-spin-enabled"))),t.hasAttribute("data-gesture-slidex-enabled")&&(i.gestureSlideXEnabled=o(t.getAttribute("data-gesture-slidex-enabled"))),t.hasAttribute("data-gesture-slidey-enabled")&&(i.gestureSlideYEnabled=o(t.getAttribute("data-gesture-slidey-enabled"))),t.hasAttribute("data-center-offset-x")&&(i.centerOffsetX=parseFloat(t.getAttribute("data-center-offset-x"))),t.hasAttribute("data-center-offset-y")&&(i.centerOffsetY=parseFloat(t.getAttribute("data-center-offset-y"))),t.hasAttribute("data-indicator-auto-rotate")&&(i.indicatorAutoRotate=o(t.getAttribute("data-indicator-auto-rotate"))),t.hasAttribute("data-indicator-auto-position")&&(i.indicatorAutoPosition=o(t.getAttribute("data-indicator-auto-position"))),t.hasAttribute("data-indicator-start-angle")&&(i.indicatorStartAngle=parseFloat(t.getAttribute("data-indicator-start-angle"))),t.hasAttribute("data-indicator-radius")&&(i.indicatorRadius=parseFloat(t.getAttribute("data-indicator-radius"))),t.hasAttribute("data-sprite-width")&&(i.spriteWidth=parseFloat(t.getAttribute("data-sprite-width"))),t.hasAttribute("data-sprite-height")&&(i.spriteHeight=parseFloat(t.getAttribute("data-sprite-height"))),t.hasAttribute("data-sprite-count")&&(i.spriteCount=parseInt(t.getAttribute("data-sprite-count"),10)),t.hasAttribute("data-sprite-direction")&&(i.spriteDirection=function(t){if(t&&("cw"==(t=t.toLowerCase())||"ccw"==t))return t;return n}(t.getAttribute("data-sprite-direction"))),t.hasAttribute("data-sprite-start-angle")&&(i.spriteStartAngle=parseFloat(t.getAttribute("data-sprite-start-angle"))),t.hasAttribute("data-sprite-separation-angle")&&(i.spriteSeparationAngle=parseFloat(t.getAttribute("data-sprite-separation-angle"))),t.hasAttribute("data-sprite-separation-gap")&&(i.spriteSeparationGap=parseFloat(t.getAttribute("data-sprite-separation-gap"))),this.options={gestureSpinEnabled:!0,gestureSlideXEnabled:!0,gestureSlideYEnabled:!0,angleStart:Number.NEGATIVE_INFINITY,angleEnd:Number.POSITIVE_INFINITY,valueMin:Number.NEGATIVE_INFINITY,valueMax:Number.POSITIVE_INFINITY,value:0,angleValueRatio:.1,angleSlideRatio:1,centerOffsetX:0,centerOffsetY:0,indicatorStartAngle:0,indicatorAutoRotate:!1,indicatorAutoPosition:!1,indicatorRadius:0,spriteWidth:67,spriteHeight:67,spriteCount:1,spriteDirection:"ccw",spriteStartAngle:0,spriteSeparationAngle:3,spriteSeparationGap:0},i)this.options[a]!==n&&(this.options[a]=i[a]);if(this.options.valueMin>this.options.valueMax)throw new Error("valueMin must be less than valueMax");this.val(this.options.value)}),__isTracking:!1,__isTurning:!1,__initialTouchLeft:null,__initialTouchTop:null,__initialTouchLocationX:null,__initialTouchLocationY:null,__slideXDetected:!1,__slideYDetected:!1,__spinDetected:!1,__lastTouchLeft:null,__lastTouchTop:null,__lastTouchMove:null,__positions:null,__clientLeft:0,__clientTop:0,__clientWidth:0,__clientHeight:0,setDimensions:function(t,e){t&&(this.__clientWidth=t),e&&(this.__clientHeight=e),this.__updateCenterLocation(),this.__publish()},setPosition:function(t,e){this.__clientLeft=t||0,this.__clientTop=e||0,this.__updateCenterLocation(),this.__publish()},val:function(t){return t&&this.__validateAndPublishValue(t,!0),this.__value},angle:function(t){return t&&this.__validateAndPublishAngle(t,!0),this.__angle},doMouseScroll:function(t,e,i,a){var n=s(t,-20,20);n=i>=this.__centerPageX?-n:n,n*=this.options.angleSlideRatio,this.__validateAndPublishAngle(this.__angle+n)},doTouchStart:function(t,e){if(null==t.length)throw new Error("Invalid touch list: "+t);if("number"!=typeof e)throw new Error("Invalid timestamp value: "+e);var i=this,a=1===t.length,n=t[0].pageX,o=t[0].pageY;i.__initialTouchLeft=n,i.__initialTouchTop=o,i.__initialAngle=l(i.__initialTouchLeft,i.__initialTouchTop,i.__centerPageX,i.__centerPageY),i.__initialAngleDiff=function(t,e){return t%360-e%360}(i.__initialAngle,i.__angle),i.__lastTouchLeft=n,i.__lastTouchTop=o,i.__lastTouchMove=e,i.__slideXDetected=!a&&i.options.gestureSlideXEnabled,i.__slideYDetected=!a&&i.options.gestureSlideYEnabled,i.__initialTouchLocationX=n>=i.__centerPageX?"right":"left",i.__initialTouchLocationY=o>=i.__centerPageY?"bottom":"top",i.__isTracking=!0,i.__isTurning=!a,i.__spinDetected=i.options.gestureSpinEnabled,i.__totalDistance=0,i.__isSingleTouch=a,i.__isGestureLocked=!1,i.__positions=[]},doTouchMove:function(t,e,i){if(null==t.length)throw new Error("Invalid touch list: "+t);if("number"!=typeof e)throw new Error("Invalid timestamp value: "+e);var a=this;if(a.__isTracking){var n=t[0].pageX,o=t[0].pageY,r=a.__positions;if(a.__validateAndPublishAngle(a.__getAngleFromGesture(n,o)),a.__isTurning=!0,!a.__isGestureLocked){var s=Math.abs(n-a.__initialTouchLeft),l=Math.abs(o-a.__initialTouchTop);a.__slideXDetected=a.options.gestureSlideXEnabled&&35<=s&&l<5,a.__slideYDetected=a.options.gestureSlideYEnabled&&35<=l&&s<5,40<a.__totalDistance&&(a.__isGestureLocked=!0,a.__slideXDetected&&a.__slideYDetected?(a.__slideXDetected=a.__slideYDetected=!1,a.__spinDetected=a.options.gestureSpinEnabled):a.__slideXDetected?a.__spinDetected=a.__slideYDetected=!1:a.__slideYDetected&&(a.__spinDetected=a.__slideXDetected=!1)),a.__totalDistance+=function(t,e,i,a){return Math.sqrt((t-=i)*t+(e-=a)*e)}(a.__lastTouchLeft,a.__lastTouchTop,n,o)}60<r.length&&r.splice(0,30),r.push({left:n,top:o,time:e}),a.__lastTouchLeft=n,a.__lastTouchTop=o,a.__lastTouchMove=e}},doTouchEnd:function(t){if("number"!=typeof t)throw new Error("Invalid timestamp value: "+t);this.__isTracking&&(this.__isTurning=!1,this.__positions.length=0)},__validateAndPublishAngle:function(t,e){var i,a,n,o,r=this;e&&(this.__angle=r.__validateAngle(t,!0)),o=function(t,e){var i=Math.abs(t-e)%360;return 180<i?360-i:i}(a=_(i=r.__angle),n=_(t)),o=function(t,e){return!(t<30&&330<e)&&(330<t&&e<30||t<e)}(a,n)?o:-o;var s=r.__validateAngle(r.__angle+o);r.__angle=s,r.__value=r.__valueFromAngles(e?s:i,s),r.__publish()},__validateAndPublishValue:function(t,e){var i=this;i.__value=i.__validateValue(t,!0),i.__angle=i.__angleFromValue(i.__value),i.__publish()},__validateAngle:function(t,e){var i=this;if(t=s(t,i.options.angleStart,i.options.angleEnd),!e){i.__angle==i.options.angleStart&&30<Math.abs(t-i.__angle)&&(t=i.options.angleStart),i.__angle==i.options.angleEnd&&30<Math.abs(t-i.__angle)&&(t=i.options.angleEnd)}return t},__validateValue:function(t,e){return s(t,this.options.valueMin,this.options.valueMax)},__valueFromAngles:function(t,e){var i=this;if(isFinite(i.options.angleStart)&&isFinite(i.options.angleEnd)&&i.options.valueMin!=Number.NEGATIVE_INFINITY&&i.options.valueMax!=Number.POSITIVE_INFINITY)return r(e,i.options.angleStart,i.options.angleEnd,i.options.valueMax,i.options.valueMin);var a=i.__value+(t-e)*i.options.angleValueRatio;return i.__validateValue(a)},__angleFromValue:function(t){var e=this;if(isFinite(e.options.valueMin)&&isFinite(e.options.valueMax)&&e.options.angleStart!=Number.NEGATIVE_INFINITY&&e.options.angleEnd!=Number.POSITIVE_INFINITY)return r(t,e.options.valueMin,e.options.valueMax,e.options.angleStart,e.options.angleEnd);var i=e.__angle+(t-e.__value)/e.options.angleValueRatio;return e.__validateAngle(i,!0)},__publish:function(){var t=this,e=t.__getIndicator(t.__angle),i=t.__getSpriteOffset(t.__angle);t.element.value=t.__value,t.__callback&&t.__callback(t,e,i)},__getIndicator:function(t){var e=this,i={};if(e.options.indicatorAutoPosition){var a=function(t){return t*(Math.PI/180)}(t);i.x=e.__centerPageX-e.__clientLeft+e.options.indicatorRadius*Math.cos(a),i.y=e.__centerPageY-e.__clientTop-e.options.indicatorRadius*Math.sin(a)}else i.x=e.__centerPageX-e.__clientLeft,i.y=e.__centerPageY-e.__clientTop;return e.options.indicatorAutoRotate?i.angle=t-e.options.indicatorStartAngle:i.angle=0,i},__getSpriteOffset:function(t){var e=this,i=0;if(1<e.options.spriteCount){var a="ccw"===e.options.spriteDirection?t:-t;a+=e.options.spriteStartAngle;var n=Math.floor(a/e.options.spriteSeparationAngle)%e.options.spriteCount;n<0&&(n+=e.options.spriteCount),i=e.options.spriteSeparationGap*(n+1)+e.options.spriteWidth*n}return{x:i,y:e.options.spriteSeparationGap}},__getAngleFromGesture:function(t,e){var i=this,a=i.__angle;if(i.__spinDetected)a=l(t,e,i.__centerPageX,i.__centerPageY),a-=i.__initialAngleDiff;else{if(i.__slideXDetected){var n=(t-i.__lastTouchLeft)*i.options.angleSlideRatio;a+="top"===i.__initialTouchLocationY?-n:n}if(i.__slideYDetected){n=(e-i.__lastTouchTop)*i.options.angleSlideRatio;a+="right"===i.__initialTouchLocationX?-n:n}}return a},__updateCenterLocation:function(){var t=this;t.__centerPageX=t.__clientLeft+t.__clientWidth/2+t.options.centerOffsetX,t.__centerPageY=t.__clientTop+t.__clientHeight/2+t.options.centerOffsetY}};for(var e in t)Knob.prototype[e]=t[e]}();